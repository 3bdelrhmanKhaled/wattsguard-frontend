<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฎุทูุงุช ุงูุฃุฌูุฒุฉ - WattsGuard</title>
    <link rel="icon" type="image/png" href="images/Rectangle-1.png">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="icons">
                <a href="#" class="notification"><i class="far fa-bell"></i></a>
            </div>
            <h2 class="text-s">ุฅุถุงูุฉ ุฌูุงุฒ</h2>
            <a href="season.html" class="back text-decoration-none"><i class="fa-solid fa-arrow-right"></i></a>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-bar-fill" id="progressBarFill"></div>
            </div>
            <div class="progress-steps" id="progressBar"></div>
        </div>
        <div class="step-counter" id="stepCounter"></div>
        <div id="step-container"></div>

        <div class="text-center">
            <button id="yourDevicesButton" class="btn btn-primary" style="display:none">ุงูุฃุฌูุฒุฉ ุงูุฎุงุต ุจู</button>
            <button id="detailedConsumptionButton" class="btn btn-primary" style="display:none">ุงูุฌุฏูู ุงูุชูุตููู ูุงุณุชููุงู ุงูููุฑุจุงุก</button>
            <div class="loading-spinner" id="loadingSpinner"></div>
        </div>

        <div id="result-section" style="display:none; margin-top: 20px;">
            <div class="result-card">
                <h4 class="text-right">ุงูุฌุฏูู ุงูุฃูู: ุจูุงูุงุช ุงูุฃุฌูุฒุฉ</h4>
                <table class="table table-bordered text-right">
                    <thead><tr><th>ุงููุฆุฉ</th><th>ุงูุทุงูุฉ ุงูููุฑุจุงุฆูุฉ</th><th>ุงุณู ุงูููุฏูู</th></tr></thead>
                    <tbody id="rawPowerTable"></tbody>
                </table>
            </div>
            <div class="result-card">
                <h4 class="text-right">ุงูุฌุฏูู ุงูุซุงูู: ุงูุฌุฏูู ุงูุชูุตููู ูุงุณุชููุงู ุงูููุฑุจุงุก ุญุณุจ ููุน ุงูุฌูุงุฒ</h4>
                <table class="table table-bordered text-right">
                    <thead><tr><th>ุงููุฆุฉ</th><th>ุงุณู ุงูููุฏูู</th><th>ุงูุงุณุชููุงู ุงูุดูุฑู (ู.ู.ุณ)</th><th>ุนุฏุฏ ุณุงุนุงุช ุงูุชุดุบูู ูููููุง</th></tr></thead>
                    <tbody id="summaryTable"></tbody>
                </table>
                <p id="billRange" class="mt-4 text-right font-weight-bold"></p>
                <p id="message" class="text-danger text-right"></p>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/electricity.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            if (!token) {
                const messageElement = document.getElementById('message');
                messageElement.innerText = 'ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู';
                setTimeout(() => {
                    window.location.href = 'Login.html';
                }, 5000);
                return;
            }
        });

        const devices = [
            { name: "ุงูููุฒุงููุฉ", models: [] },
            { name: "ุซูุงุฌุฉ", models: ["FNT-B400 BB"] },
            { name: "ุบุณุงูุฉ", models: ["EL1087567SLV", "EL1094877SLV"] },
            { name: "ูููู", models: ["S4-H24TZAAE"] },
            { name: "ุบูุงูุฉ ููุฑุจุงุฆูุฉ", models: ["EL1113367BLK"] },
            { name: "ุณุฎุงู ููุงู", models: ["TEEE-30MW"] },
            { name: "ููุงูุฉ", models: ["TDF-3700"] },
            { name: "ูููุณุฉ ููุฑุจุงุฆูุฉ", models: ["TVC-1200B"] },
            { name: "ุบุณุงูุฉ ุฃุทุจุงู", models: ["EL1108866SLV"] },
            { name: "ุจูุชุงุฌุงุฒ", models: ["HP41125B"] },
            { name: "ูููุงุฉ ุจุฎุงุฑ", models: ["GS42622A"] },
            { name: "ูุฑู", models: ["ak-45"] },
            { name: "ูููุฑูููู", models: ["MOM-C25BBE-BK"] },
            { name: "ุงูุฃุฌูุฒุฉ ุงูุฎุงุต ุจู", models: [] },
            { name: "ุงูุฌุฏูู ุงูุชูุตููู", models: [] }
        ];

        let currentStep = 0;
        let answers = [];
        let structuredAnswers = [];
        let budget = null;
        let apiData = null;

        const urlParams = new URLSearchParams(window.location.search);
        const season = urlParams.get('season') || 'summer';

        function renderProgressBar() {
            const totalSteps = 1 + (devices.length - 3) * 3;
            const visibleSteps = 15;
            const stepNumbers = Array.from({ length: visibleSteps }, (_, i) => i + 1);
            let visibleStep = 0;
            if (currentStep === 0) {
                visibleStep = 0;
            } else if (currentStep <= 36) {
                const deviceIndex = Math.min(Math.floor((currentStep - 1) / 3), devices.length - 3);
                visibleStep = deviceIndex + 1;
            } else if (currentStep === 37) {
                visibleStep = 13;
            } else {
                visibleStep = 14;
            }
            const progressPercentage = ((visibleStep + 1) / visibleSteps) * 100;
            document.getElementById("progressBarFill").style.width = `${progressPercentage}%`;
            document.getElementById("progressBar").innerHTML = stepNumbers.map((n, i) => `
                <div class="step-item">
                    <span class="${i === visibleStep ? 'active' : ''}">${n}</span>
                </div>
            `).join('');
            document.getElementById("stepCounter").innerText = `ุงูุฎุทูุฉ ${visibleStep + 1} ูู ${visibleSteps}`;
        }

        async function sendToBackend(budget, structuredAnswers) {
            const loadingSpinner = document.getElementById("loadingSpinner");
            const messageElement = document.getElementById("message");
            
            loadingSpinner.classList.add("active");
            messageElement.innerText = '';

            const payload = [budget, ...structuredAnswers.flat()];
            console.log("๐ค ุฌุงุฑู ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ุงูุณูุฑูุฑ... Payload:", payload);

            try {
                const data = await window.electricity.calculate(payload, season);
                console.log('โ ุงูุจูุงูุงุช ุงููุณุชููุฉ ูู ุงูุณูุฑูุฑ:', data);

                // Format power values to include unit
                const formattedData = {
                    raw_power_data: data.rawPowerData?.map(row => ({
                        ...row,
                        "Electric Power": `${parseFloat(row["Electric Power"] || 0).toFixed(2)} ูุงุท`
                    })) || [],
                    summary: data.summary?.map(row => ({
                        ...row,
                        "Monthly Consumption (kWh)": `${parseFloat(row["Monthly Consumption (kWh)"] || 0).toFixed(2)} ู.ู.ุณ`
                    })) || [],
                    estimated_bill_range: data.estimatedBillRange || '',
                    message: data.message || ''
                };

                apiData = formattedData;
                console.log("๐ฆ ูุญุชูู apiData ุจุนุฏ ุงููุนุงูุฌุฉ:", apiData);

                // Update the tables immediately
                updateTables();
            } catch (error) {
                console.error('๐จ ุฎุทุฃ ุฃุซูุงุก ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ุงูุณูุฑูุฑ:', error);
                apiData = {
                    raw_power_data: [],
                    summary: [],
                    estimated_bill_range: "",
                    message: "ูุดู ูู ุฌูุจ ุงูุจูุงูุงุช ูู ุงูุณูุฑูุฑ"
                };
                messageElement.innerText = `ุญุฏุซ ุฎุทุฃ: ${error.message}. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู ูุงุญููุง.`;
            } finally {
                loadingSpinner.classList.remove("active");
            }
        }

        document.getElementById("yourDevicesButton").addEventListener("click", () => {
            if (!apiData) {
                document.getElementById("message").innerText = "ูุฑุฌู ุงูุงูุชุธุงุฑ ุญุชู ูุชู ุฌูุจ ุงูุจูุงูุงุช";
                return;
            }

            const resultSection = document.getElementById("result-section");
            resultSection.style.display = "block";

            const rawPowerTable = document.getElementById("rawPowerTable");
            if (!rawPowerTable) {
                console.error("ุงูุนูุตุฑ rawPowerTable ุบูุฑ ููุฌูุฏ ูู ุงูู DOM");
                return;
            }

            if (apiData.raw_power_data && apiData.raw_power_data.length > 0) {
                rawPowerTable.innerHTML = apiData.raw_power_data.map(row =>
                    `<tr><td>${row.Category || 'ุบูุฑ ูุญุฏุฏ'}</td><td>${row["Electric Power"] || 'ุบูุฑ ูุนุฑูู'}</td><td>${row["Model Name"] || 'ุบูุฑ ูุนุฑูู'}</td></tr>`
                ).join('');
            } else {
                rawPowerTable.innerHTML = `<tr><td colspan="3" class="no-data-message">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุชุงุญุฉ ููุนุฑุถ</td></tr>`;
            }

            document.getElementById("yourDevicesButton").style.display = "none";
            currentStep++;
            renderStep();
        });

        function updateTables() {
            const resultSection = document.getElementById("result-section");
            resultSection.style.display = "block";

            // Update raw power table
            const rawPowerTable = document.getElementById("rawPowerTable");
            if (apiData.raw_power_data && apiData.raw_power_data.length > 0) {
                rawPowerTable.innerHTML = apiData.raw_power_data.map(row =>
                    `<tr>
                        <td>${row.Category || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>${row["Electric Power"] || 'ุบูุฑ ูุนุฑูู'}</td>
                        <td>${row["Model Name"] || 'ุบูุฑ ูุนุฑูู'}</td>
                    </tr>`
                ).join('');
            } else {
                rawPowerTable.innerHTML = `<tr><td colspan="3" class="no-data-message">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุชุงุญุฉ ููุนุฑุถ</td></tr>`;
            }

            // Update summary table
            const summaryTable = document.getElementById("summaryTable");
            if (apiData.summary && apiData.summary.length > 0) {
                summaryTable.innerHTML = apiData.summary.map(row =>
                    `<tr>
                        <td>${row.Category || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>${row["Model Name"] || 'ุบูุฑ ูุนุฑูู'}</td>
                        <td>${row["Monthly Consumption (kWh)"] || 'ุบูุฑ ูุนุฑูู'}</td>
                        <td>${row["Daily Hours"] || 'ุบูุฑ ูุนุฑูู'}</td>
                    </tr>`
                ).join('');
            } else {
                summaryTable.innerHTML = `<tr><td colspan="4" class="no-data-message">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุชุงุญุฉ ููุนุฑุถ</td></tr>`;
            }

            // Update bill range and message
            document.getElementById("billRange").innerText = apiData.estimated_bill_range ? `ุงููุทุงู ุงูุชูุฏูุฑู ูููุงุชูุฑุฉ: ${apiData.estimated_bill_range} ุฌููู` : '';
            document.getElementById("message").innerText = apiData.message || '';
        }

        function renderStep() {
            const container = document.getElementById("step-container");
            container.innerHTML = "";
            document.getElementById("yourDevicesButton").style.display = "none";
            document.getElementById("detailedConsumptionButton").style.display = "none";
            renderProgressBar();

            const card = document.createElement("div");
            card.classList.add("question-card");

            if (currentStep === 0) {
                card.innerHTML = `
                    <label for="budget">ูุง ูู ุงูุญุฏ ุงูุฃูุตู ููููุฒุงููุฉ ุงูุดูุฑูุฉุ</label>
                    <p class="text-muted">ุฃุฏุฎู ุงููุจูุบ ุงูุดูุฑู ุงูุฐู ุชุฑุบุจ ูู ุฅููุงูู</p>
                    <input type="number" id="budget" class="form-control" min="100" placeholder="ุฃุฏุฎู ุงูููุฒุงููุฉ (ุฌููู)">
                    <button class="btn btn-primary mt-3" onclick="saveBudget()">ุงูุชุงูู</button>`;
            } else if (currentStep < 1 + (devices.length - 3) * 3) {
                const deviceIndex = Math.min(Math.floor((currentStep - 1) / 3), devices.length - 3);
                const device = devices[deviceIndex + 1];
                if ((currentStep - 1) % 3 === 0) {
                    card.innerHTML = `
                        <h3>ูู ูุฏูู ${device.name}ุ</h3>
                        <p class="text-muted">ุญุฏุฏ ูุง ุฅุฐุง ูุงู ูุฏูู ูุฐุง ุงูุฌูุงุฒ</p>
                        <button class="btn btn-primary" onclick="handleYes()">ูุนู</button>
                        <button class="btn btn-primary" onclick="handleNo()">ูุง</button>`;
                } else if ((currentStep - 1) % 3 === 1) {
                    card.innerHTML = `
                        <label for="deviceCount">ูู ุนุฏุฏ ${device.name} ูุฏููุ</label>
                        <p class="text-muted">ุฃุฏุฎู ุนุฏุฏ ุงูุฃุฌูุฒุฉ ุงูููุฌูุฏุฉ</p>
                        <input type="number" id="deviceCount" class="form-control" min="1" placeholder="ุฃุฏุฎู ุงูุนุฏุฏ">
                        <button class="btn btn-primary mt-3" onclick="nextStep()">ุงูุชุงูู</button>`;
                } else {
                    const count = answers[answers.length - 1];
                    card.innerHTML = `
                        <h4>ุงุฎุชุฑ ุงูููุฏููุงุช (${device.name})</h4>
                        <p class="text-muted">ุงูุชุจ ุงุณู ุงูููุฏูู ุฃู ุงุฎุชุฑ ูู ุงูุงูุชุฑุงุญุงุช</p>
                        ${Array.from({ length: count }, (_, i) => `
                            <div class="model-details-container">
                                <div style="flex: 1;">
                                    <input type="text" id="model_${i}" list="model_list_${i}" class="form-control my-2 model-input" placeholder="ุงูุชุจ ุฃู ุงุฎุชุฑ ุงูููุฏูู">
                                    <datalist id="model_list_${i}">
                                        ${device.models.map(model => `<option value="${model}">${model}</option>`).join('')}
                                    </datalist>
                                </div>
                                <div class="model-details" id="modelDetails_${i}" style="display: none; flex: 1;"></div>
                            </div>
                            <div class="image-upload">
                                <label for="model_image_${i}">ุฅุฐุง ููุช ูุง ุชุนูู ููุน ุงูุฌูุงุฒุ ููููู ุฑูุน ุตูุฑุฉ ููุชุนุฑู ุนููู</label>
                                <input type="file" id="model_image_${i}" accept="image/*" title="ุงุฑูุน ุตูุฑุฉ ููุชุนุฑู ุนูู ุงูุฌูุงุฒ">
                            </div>`).join('')}
                        <button class="btn btn-primary mt-3" onclick="submitModels(${count})">ุงูุชุงูู</button>`;
                }
            } else if (currentStep >= 37) {
                document.getElementById("yourDevicesButton").style.display = "inline-block";
                document.getElementById("detailedConsumptionButton").style.display = "inline-block";
                card.innerHTML = `<p class="text-center">ุชู ุฌูุน ุจูุงูุงุช ุงูุฃุฌูุฒุฉ ุจูุฌุงุญุ ููููู ุงูุขู ุนุฑุถ ุงููุชุงุฆุฌ.</p>`;
            }
            container.appendChild(card);

            if ((currentStep - 1) % 3 === 2 && currentStep < 37) {
                const count = answers[answers.length - 1];
                setTimeout(() => {
                    for (let i = 0; i < count; i++) {
                        const modelInput = document.getElementById(`model_${i}`);
                        const modelDetails = document.getElementById(`modelDetails_${i}`);
                        if (modelInput && modelDetails) {
                            modelInput.addEventListener('change', () => {
                                const modelName = modelInput.value.trim();
                                if (modelName) {
                                    getModelDetails(modelName, modelDetails);
                                } else {
                                    modelDetails.style.display = 'none';
                                }
                            });
                        }
                    }
                }, 0);
            }
        }

        async function getModelDetails(modelName, detailsElement) {
            const messageElement = document.getElementById("message");
            messageElement.innerText = "";
            detailsElement.innerHTML = '<div class="loading-spinner active"></div>';

            try {
                const data = await window.electricity.getModelDetails(encodeURIComponent(modelName));
                console.log('ุจูุงูุงุช ุงูุงุณุชุฌุงุจุฉ:', data);

                if (data.success && data.modelDetails) {
                    const detailsStr = data.modelDetails;
                    // Split the details string into lines and create an object
                    const details = {};
                    detailsStr.split('\n').forEach(line => {
                        if (line.includes(':')) {
                            const [key, value] = line.split(':').map(s => s.trim());
                            details[key] = value;
                        }
                    });
                    
                    // Clean up and convert power value
                    let power = details["Electric Power"];
                    if (power) {
                        // Remove any whitespace and normalize decimal separator
                        power = power.replace(/\s+/g, '').replace(',', '.');
                        
                        // Check if it's in kW format
                        if (power.includes('kW')) {
                            power = parseFloat(power) * 1000 + ' ูุงุท';
                        } else if (power.includes('W')) {
                            // Remove the 'W' and keep the number
                            power = parseFloat(power) + ' ูุงุท';
                        } else {
                            // If no unit is specified, assume kW
                            power = parseFloat(power) * 1000 + ' ูุงุท';
                        }
                        
                        // Round to 2 decimal places if needed
                        const powerNum = parseFloat(power);
                        if (!isNaN(powerNum)) {
                            power = powerNum.toFixed(2) + ' ูุงุท';
                        }
                    }

                    detailsElement.innerHTML = `
                        <strong>ุงุณู ุงูููุฏูู:</strong> ${details["Model Name"] || 'ุบูุฑ ูุนุฑูู'}<br>
                        <strong>ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ:</strong> ${details.Brand || 'ุบูุฑ ูุนุฑูู'}<br>
                        <strong>ุงููุฆุฉ:</strong> ${details["catogory"] || 'ุบูุฑ ูุนุฑูู'}<br>
                        <strong>ุงูุทุงูุฉ ุงูููุฑุจุงุฆูุฉ:</strong> ${power || 'ุบูุฑ ูุนุฑูู'}<br>
                        ${details.Capacity ? `<strong>ุงูุณุนุฉ:</strong> ${details.Capacity} ูุชุฑ` : ''}
                    `;
                    detailsElement.style.display = 'block';
                } else {
                    const errorMessage = data.error || 'ูุง ุชูุฌุฏ ุชูุงุตูู ูุชููุฑุฉ ููุฐุง ุงูููุฏูู';
                    detailsElement.innerHTML = `
                        <div class="error-message">
                            <strong>ุฎุทุฃ:</strong> ${errorMessage}<br>
                            <small>ููููู ุฅุถุงูุฉ ูุฐุง ุงูููุฏููุ ููู ุณูุชู ุงุณุชุฎุฏุงู ููู ุงูุชุฑุงุถูุฉ ูุญุณุงุจ ุงุณุชููุงู ุงูุทุงูุฉ.</small>
                        </div>
                    `;
                    detailsElement.style.display = 'block';
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฌูุจ ุชูุงุตูู ุงูููุฏูู:', error);
                detailsElement.innerHTML = `
                    <div class="error-message">
                        <strong>ุฎุทุฃ:</strong> ${error.message}<br>
                        <small>ููููู ุฅุถุงูุฉ ูุฐุง ุงูููุฏููุ ููู ุณูุชู ุงุณุชุฎุฏุงู ููู ุงูุชุฑุงุถูุฉ ูุญุณุงุจ ุงุณุชููุงู ุงูุทุงูุฉ.</small>
                    </div>
                `;
                detailsElement.style.display = 'block';
                messageElement.innerText = `ุฎุทุฃ: ${error.message}`;
            }
        }

        function saveBudget() {
            const input = document.getElementById("budget").value;
            if (!input || input < 100) {
                document.getElementById("message").innerText = "ูุฑุฌู ุฅุฏุฎุงู ููุฒุงููุฉ ุตุงูุญุฉ (100 ุฌููู ุฃู ุฃูุซุฑ)";
                return;
            }
            budget = input.toString();
            currentStep++;
            renderStep();
        }

        function handleYes() {
            answers.push("yes");
            structuredAnswers.push(["yes"]);
            currentStep++;
            renderStep();
        }

        function handleNo() {
            answers.push("no");
            structuredAnswers.push(["no", "0"]);
            currentStep = Math.min(currentStep + 3, 1 + (devices.length - 3) * 3);
            renderStep();
        }

        function nextStep() {
            const count = parseInt(document.getElementById("deviceCount").value);
            if (!count || count < 1) {
                document.getElementById("message").innerText = "ูุฑุฌู ุฅุฏุฎุงู ุนุฏุฏ ุตุญูุญ";
                return;
            }
            answers.push(count.toString());
            structuredAnswers[structuredAnswers.length - 1].push(count.toString());
            currentStep++;
            renderStep();
        }

        async function submitModels(count) {
            const messageElement = document.getElementById("message");
            messageElement.innerText = "";

            for (let i = 0; i < count; i++) {
                const model = document.getElementById(`model_${i}`).value.trim();
                if (!model) {
                    messageElement.innerText = `ูุฑุฌู ูุชุงุจุฉ ุฃู ุงุฎุชูุงุฑ ููุฏูู ููุฌูุงุฒ ุฑูู ${i + 1}`;
                    return;
                }
                answers.push(model);
                structuredAnswers[structuredAnswers.length - 1].push(model);

                const imageInput = document.getElementById(`model_image_${i}`);
                if (imageInput.files.length > 0) {
                    try {
                        const formData = new FormData();
                        formData.append('image', imageInput.files[0]);
                        await window.api.post('/Electricity/upload-image', formData);
                        console.log(`ุชู ุฑูุน ุตูุฑุฉ ููุฌูุงุฒ ${i + 1}:`, imageInput.files[0].name);
                    } catch (error) {
                        console.error('ุฎุทุฃ ูู ุฑูุน ุงูุตูุฑุฉ:', error);
                        messageElement.innerText = `ุฎุทุฃ ูู ุฑูุน ุตูุฑุฉ ุงูุฌูุงุฒ ${i + 1}: ${error.message}`;
                        return;
                    }
                }
            }
            currentStep++;
            if (currentStep === 37) {
                await sendToBackend(budget, structuredAnswers);
            }
            renderStep();
        }

        document.getElementById("detailedConsumptionButton").addEventListener("click", () => {
            if (!apiData) {
                document.getElementById("message").innerText = "ูุฑุฌู ุนุฑุถ ุงูุฃุฌูุฒุฉ ุงูุฎุงุต ุจู ุฃููุงู";
                return;
            }

            const summaryTable = document.getElementById("summaryTable");
            if (!summaryTable) {
                console.error("ุงูุนูุตุฑ summaryTable ุบูุฑ ููุฌูุฏ ูู ุงูู DOM");
                return;
            }

            if (apiData.summary && apiData.summary.length > 0) {
                summaryTable.innerHTML = apiData.summary.map(row => `
                    <tr>
                        <td>${row.Category || 'ุบูุฑ ูุญุฏุฏ'}</td>
                        <td>${row["Model name"] || 'ุบูุฑ ูุนุฑูู'}</td>
                        <td>${row["Monthly Consumption (kWh)"] || 'ุบูุฑ ูุนุฑูู'}</td>
                        <td>${row["Daily Hours"] || 'ุบูุฑ ูุนุฑูู'}</td>
                    </tr>
                `).join('');
                document.getElementById("billRange").innerText = apiData.estimated_bill_range ? `ุงููุทุงู ุงูุชูุฏูุฑู ูููุงุชูุฑุฉ: ${apiData.estimated_bill_range} ุฌููู` : '';
                document.getElementById("message").innerText = apiData.message || '';
            } else {
                summaryTable.innerHTML = `<tr><td colspan="4" class="no-data-message">ูุง ุชูุฌุฏ ุจูุงูุงุช ุงุณุชููุงู ูุชุงุญุฉ ุญุงูููุง</td></tr>`;
                document.getElementById("billRange").innerText = apiData.estimated_bill_range ? `ุงููุทุงู ุงูุชูุฏูุฑู ูููุงุชูุฑุฉ: ${apiData.estimated_bill_range} ุฌููู` : '';
                document.getElementById("message").innerText = apiData.message || '';
            }
            document.getElementById("detailedConsumptionButton").style.display = "none";
        });

        document.addEventListener('DOMContentLoaded', function() {
            renderStep();
        });

        function logout() {
            localStorage.removeItem('token');
            window.location.href = 'Login.html';
        }
    </script>
</body>
</html>